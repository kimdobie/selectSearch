
// Version 1.2.2 - beta (aka inprogress)
// Date: 08/03/2010

jQuery.fn.selectSearch=function(e,c){return this.each(function(){var b=jQuery(this),a=jQuery(e),f=true,g=false,i=true,k=true,m=false,n=true;if(c!=undefined){if(c.showEmptyOptGroup!=undefined&&typeof c.showEmptyOptGroup=="boolean")m=c.showEmptyOptGroup;if(c.selectLast!=undefined&&typeof c.selectLast=="boolean")f=c.selectLast;if(c.startSearchFromFront!=undefined&&typeof c.startSearchFromFront=="boolean")g=c.startSearchFromFront;if(c.fixedWidth!=undefined&&typeof c.fixedWidth=="boolean")n=c.fixedWidth; if(c.sortOptions!=undefined&&typeof c.sortOptions=="boolean")i=c.sortOptions;if(c.sortOptGroups!=undefined&&typeof c.sortOptGroups=="boolean")k=c.sortOptGroups}n&&b.css("width",b.css("width"));a.val("");a.keyup(function(){jQuery(this).val();for(var d=true,h=[],o=selectSearch_Options.optionItems[b.attr("id")],r=cleanInput(a.val()),l=0;l<o.length;l++){h[l]=Array(o[l][0],[]);for(j=0;j<o[l][1].length;j++)(d=g?matchingFromStart(r,o[l][1][j].text):matching(r,o[l][1][j].text))&&h[l][1].push(o[l][1][j])}b.selectSearch_buildOptions(h, m);f&&b.find("option").length==1&&b.find("option").attr("selected","selected")});b.change(function(){var d=jQuery(this).val();selectSearch_Options.optionItems[b.attr("id")+"_selected"]=[];if(typeof d=="string")selectSearch_Options.optionItems[b.attr("id")+"_selected"].push(d);else for(var h=0;h<d.length;h++)selectSearch_Options.optionItems[b.attr("id")+"_selected"].push(d[h])});cleanInput=function(d){d=d.replace("(","\\(");d=d.replace(")","\\)");d=d.replace("*","\\*");d=d.replace("+","\\+");d=d.replace("[", "\\[");d=d.replace("]","\\]");d=d.replace("?","\\?");return d=d.replace("|","\\|")};if(b.attr("id")==""){b.attr("id","selectSearch_SelectList"+selectSearch_IDCounter);selectSearch_IDCounter++}b.attr("id");var p=[];selectSearch_Options.optionItems[b.attr("id")+"_selected"]=[];var s=null,q=-1;b.children().each(function(){var d="",h=false;if(this.tagName.toLowerCase()=="optgroup"){d=jQuery(this).attr("label");h=true}if(s!=d){q++;s=d;p[q]=Array(d,[])}if(h)jQuery(this).children().each(function(){p[q][1].push({text:jQuery(this).text(), value:jQuery(this).attr("value")});jQuery(this).attr("selected")&&selectSearch_Options.optionItems[b.attr("id")+"_selected"].push(jQuery(this).attr("value"))});else{p[q][1].push({text:jQuery(this).text(),value:jQuery(this).attr("value")});jQuery(this).attr("selected")&&selectSearch_Options.optionItems[b.attr("id")+"_selected"].push(jQuery(this).attr("value"))}});selectSearch_Options.optionItems[b.attr("id")]=p;b.selectSearch_sortOptions(k,i,m);matchingFromStart=function(d,h){return RegExp("^"+d+".*", "i").test(h)};matching=function(d,h){return RegExp(d,"ig").test(h)}})}; jQuery.fn.selectSearch_buildOptions=function(e,c){jQueryselectList=jQuery(this);jQueryselectList.html("");var b=false;if(selectSearch_Options.optionItems[jQueryselectList.attr("id")+"_selected"]!=undefined)b=true;for(var a=0;a<e.length;a++){var f="";if(e[a][0]!=""&&(c||e[a][1].length>0))f+="<optgroup label='"+e[a][0]+"'>";for(var g=0;g<e[a][1].length;g++){f+="<option value='"+e[a][1][g].value+"'";if(b&&jQuery.inArray(e[a][1][g].value,selectSearch_Options.optionItems[jQueryselectList.attr("id")+"_selected"])!= -1)f+="selected='selected' ";f+=">"+e[a][1][g].text+"</option>"}if(e[a][0]!=""&&(c||e[a][1].length>0))f+="</optgroup>";jQueryselectList.append(f)}return this}; jQuery.fn.selectSearch_sortOptions=function(e,c,b){selectItems=selectSearch_Options.optionItems[jQuery(this).attr("id")];e&&selectItems.sort(function(a,f){if(f[0].toLowerCase()<a[0].toLowerCase())return 1;return f[0].toLowerCase()>a[0].toLowerCase()?-1:0});if(c)for(e=0;e<selectItems.length;e++)selectItems[e][1].sort(function(a,f){if(f.text.toLowerCase()<a.text.toLowerCase())return 1;return f.text.toLowerCase()>a.text.toLowerCase()?-1:0});jQuery(this).selectSearch_buildOptions(selectItems,b);return this}; jQuery.fn.selectSearch_addOption=function(e,c,b,a){var f=true,g=true,i=true,k=null;if(a!=undefined){if(a.sortOptions!=undefined&&typeof a.sortOptions=="boolean")f=a.sortOptions;if(a.sortOptGroups!=undefined&&typeof a.sortOptGroups=="boolean")g=a.sortOptGroups;if(a.showEmptyOptGroup!=undefined&&typeof a.showEmptyOptGroup=="boolean")i=a.showEmptyOptGroup;if(a.searchBox!=undefined&&typeof a.searchBox=="object")k=a.searchBox}if(typeof b=="undefined")b="";a=selectSearch_Options.optionItems[jQuery(this).attr("id")]; for(var m=false,n=0;n<a.length&&!m;n++)if(b==a[n][0]){a[n][1].push({text:e,value:c});m=true}m||a.push(Array(b,Array({text:e,value:c})));jQuery(this).selectSearch_sortOptions(g,f,i);k!=null&&k.trigger("keyup");return this}; jQuery.fn.selectSearch_removeOption=function(e,c,b){if(c==undefined)c="";var a=true;if(b==undefined||b==""){b="";a=false}for(var f=selectSearch_Options.optionItems[jQuery(this).attr("id")],g=false,i=0;i<f.length&&!g;i++)if(b==f[i][0]||!a)for(var k=0;k<f[i][1].length&&!g;k++)if(f[i][1][k].text==e&&f[i][1][k].value==c){f[i][1].splice(k,1);g=true}if(a){b=jQuery(this).find('optgroup[label="'+b+'"]').eq(0);b.find('option[value="'+c+'"]:contains("'+e+'")').eq(0).remove();b.find("option").length==0&&b.remove()}else jQuery(this).find('option[value="'+ c+'"]:contains("'+e+'")').eq(0).remove();return this};function selectSearch_OptionsObject(){this.optionItems=[]}var selectSearch_Options=new selectSearch_OptionsObject,selectSearch_IDCounter=0;